var GameManager=pc.createScript("gameManager");GameManager.attributes.add("money_counter",{type:"entity"}),GameManager.attributes.add("levels",{type:"asset",array:!0}),GameManager.attributes.add("current_level",{type:"entity"}),GameManager.prototype.initialize=function(){GameManager.instance=this,this.money=Number(this.loadString("money",0)),this.money_counter.element.text=Math.floor(this.money),this.level_number=Number(this.loadString("level",0)),this.advanceLevel(),this.debug_mode=window.location.href.indexOf("launch.playcanvas.com")>-1,this.cool_down=0,this.pitch=1},GameManager.prototype.advanceLevel=function(){this.spawnLevel(this.level_number+1)},GameManager.prototype.spawnLevel=function(e){null!=this.current_level&&(this.current_level.destroy(),BarCont.instance.clear()),this.saveString("level",this.level_number),this.level_number=e,this.current_level=this.levels[(this.level_number-1)%this.levels.length].resource.instantiate(),this.app.root.addChild(this.current_level),setTimeout(function(){this.app.fire("do_harvest")}.bind(this),100)},GameManager.prototype.addMoney=function(e){let t=this.money;this.money+=e,this.saveString("money",this.money),this.money_counter.element.text=Math.floor(this.money),e>0&&Math.floor(t)!=Math.floor(this.money)&&(SoundManager.instance.setPitch("pop",this.pitch),SoundManager.instance.playSound("pop"),this.pitch+=.01)},GameManager.prototype.update=function(e){this.debug_mode&&(this.app.keyboard.isPressed(pc.KEY_N)&&this.addMoney(20),this.app.keyboard.isPressed(pc.KEY_R)&&(localStorage.clear(),window.location.reload()),this.app.keyboard.isPressed(pc.KEY_L)&&this.cool_down<=0&&(Harvest.all_harvest=[],CompleteMessage.instance.showMessage(function(){Fade.instance.fadeIn(.5,function(){GameManager.instance.advanceLevel(),Fade.instance.fadeOut()}.bind(this))}.bind(this)),this.cool_down=1),this.cool_down-=e),this.pitch=pc.math.lerp(this.pitch,1,e)},GameManager.prototype.saveString=function(e,t){this.supports_local_storage()&&localStorage.setItem("sp_"+e,t)},GameManager.prototype.loadString=function(e,t){return this.supports_local_storage()&&localStorage.hasOwnProperty("sp_"+e)?localStorage.getItem("sp_"+e):t},GameManager.prototype.supports_local_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},GameManager.prototype.clearSaves=function(){this.supports_local_storage()&&localStorage.clear()};var BarCont=pc.createScript("barCont");BarCont.attributes.add("bar_template",{type:"asset"}),BarCont.prototype.initialize=function(){BarCont.instance=this,this.bars=[]},BarCont.prototype.addBar=function(t){let r=this.bar_template.resource.instantiate();r.script.radialBar.bar.element.color=t.bar_color,r.script.radialBar.harvest=t,r.script.radialBar.icon_entity.element.sprite=t.icon.resource,this.entity.addChild(r),this.bars.push(r.script.radialBar)},BarCont.prototype.update=function(){for(let t=0;t<this.bars.length;t++)this.bars[t].setProgress(this.bars[t].harvest.progress)},BarCont.prototype.clear=function(){for(let t=0;t<this.bars.length;t++)this.bars[t].entity.destroy();this.bars.length=0};var Harvest=pc.createScript("harvest");Harvest.attributes.add("plantModel",{type:"asset"}),Harvest.attributes.add("plantMaterial",{type:"asset"}),Harvest.attributes.add("density",{type:"number",default:1,title:"Densidad (plantas/m)"}),Harvest.attributes.add("bar_color",{type:"rgb"}),Harvest.attributes.add("icon",{type:"asset"}),Harvest.prototype.initialize=function(){this.initialized=!1,this.entity.render.enabled=!1},Harvest.prototype.init=function(){this.initialized=!0,Harvest.all_harvest||(Harvest.all_harvest=[]),Harvest.all_harvest.push(this),this.physicalHeight=this.entity.getLocalScale().z,this.physicalWidth=this.entity.getLocalScale().x,this.center=this.entity.getPosition(),this.numCellsX=Math.round(this.physicalWidth*this.density),this.numCellsZ=Math.round(this.physicalHeight*this.density),this.cellSizeX=this.physicalWidth/this.numCellsX,this.cellSizeZ=this.physicalHeight/this.numCellsZ,this.harvested=new Uint8Array(this.numCellsX*this.numCellsZ),this.instanceCount=this.numCellsX*this.numCellsZ,this.harvestedCount=0,this.matrices=new Float32Array(16*this.instanceCount),this.matrix=new pc.Mat4;for(var t=0;t<this.instanceCount;t++){var e=t%this.numCellsX,i=Math.floor(t/this.numCellsX),s=e*this.cellSizeX-this.physicalWidth/2+this.center.x,a=i*this.cellSizeZ-this.physicalHeight/2+this.center.z,h=pc.math.random(.1*-this.cellSizeX,.1*this.cellSizeX),n=pc.math.random(.1*-this.cellSizeZ,.1*this.cellSizeZ),r=pc.math.random(0,360),l=new pc.Quat;l.setFromEulerAngles(0,r,0);var c=pc.math.random(.6,1);this.matrix.setTRS(new pc.Vec3(s+h,0,a+n),l,new pc.Vec3(1.5,c,1.5)),this.matrices.set(this.matrix.data,16*t)}var o=this.app.graphicsDevice,d=pc.VertexFormat.getDefaultInstancingFormat(o);this.instanceBuffer=new pc.VertexBuffer(o,d,this.instanceCount,pc.BUFFER_DYNAMIC,this.matrices);var p=this.plantModel.resource.meshes[0],u=this.plantMaterial.resource;this.meshInstance=new pc.MeshInstance(p,u),this.meshInstance.setInstancing(this.instanceBuffer);var m=new pc.Entity;m.addComponent("render",{meshInstances:[this.meshInstance]}),this.entity.addChild(m),this.instanceDataNeedsUpdate=!1,BarCont.instance.addBar(this),this.progress=0,this._cutter=Cutter.instance},Harvest.prototype.harvestCell=function(t,e,i){var s=t+e*this.numCellsX;if(this.harvested[s])return!1;this.harvested[s]=1,i?(this.harvestedCount++,Trunk.instance.current++,CarMovement.volume_to=1):this.instanceCount--;var a=pc.math.random(.4*-this.cellSizeX,.4*this.cellSizeX),h=pc.math.random(.4*-this.cellSizeZ,.4*this.cellSizeZ),n=t*this.cellSizeX-this.physicalWidth/2+this.center.x+a,r=e*this.cellSizeZ-this.physicalHeight/2+this.center.z+h;return this.matrix.setTRS(new pc.Vec3(n,.01,r),(new pc.Quat).setFromEulerAngles(90,pc.math.random(0,360),0),new pc.Vec3(0,0,0)),this.matrices.set(this.matrix.data,16*s),this.progress=this.harvestedCount/this.instanceCount,this.harvestedCount==this.instanceCount&&(this.enabled=!1,Harvest.all_harvest=Harvest.all_harvest.filter((t=>t!==this)),SoundManager.instance.playSound("bell"),0==Harvest.all_harvest.length&&CompleteMessage.instance.showMessage(function(){Fade.instance.fadeIn(.5,function(){GameManager.instance.advanceLevel(),Fade.instance.fadeOut(0,function(){AdsManager.instance.gameplayStart()}.bind(this))}.bind(this))}.bind(this))),!0},Harvest.prototype.update=function(t){if(!this.initialized)return void(Cutter.instance&&this.init());if(!this._cutter||!this._cutter.is_down)return;let e=CarMovement.instance.entity.script.trunk.cutter.getPosition();var i=this.getYaw(CarMovement.instance.entity.getRotation());this.harvestInRect(e.x,e.z,Cutter.instance.amount+2,2.5,-i)},Harvest.prototype.getYaw=function(t){return Math.atan2(2*(t.w*t.y+t.x*t.z),1-2*(t.y*t.y+t.z*t.z))*(180/Math.PI)},Harvest.prototype.harvestInRect=function(t,e,i,s,a,h=!0){for(var n=a*(Math.PI/180),r=Math.cos(n),l=Math.sin(n),c=i/2,o=s/2,d=Math.abs(r*c)+Math.abs(l*o),p=Math.abs(l*c)+Math.abs(r*o),u=t-d,m=t+d,v=e-p,y=e+p,M=Math.max(0,Math.floor((u-this.center.x+this.physicalWidth/2)/this.cellSizeX)),z=Math.min(this.numCellsX-1,Math.ceil((m-this.center.x+this.physicalWidth/2)/this.cellSizeX)),C=Math.max(0,Math.floor((v-this.center.z+this.physicalHeight/2)/this.cellSizeZ)),f=Math.min(this.numCellsZ-1,Math.ceil((y-this.center.z+this.physicalHeight/2)/this.cellSizeZ)),S=M;S<=z;S++)for(var g=C;g<=f;g++){var H=S*this.cellSizeX-this.physicalWidth/2+this.center.x+this.cellSizeX/2-t,X=g*this.cellSizeZ-this.physicalHeight/2+this.center.z+this.cellSizeZ/2-e,b=r*H+l*X,x=-l*H+r*X;Math.abs(b)<=c&&Math.abs(x)<=o&&this.harvestCell(S,g,h)&&(this.instanceDataNeedsUpdate=!0)}this.instanceDataNeedsUpdate&&(this.instanceBuffer.setData(this.matrices),this.instanceDataNeedsUpdate=!1)},Harvest.prototype.harvestInArea=function(t,e,i){for(var s=(t-this.center.x+this.physicalWidth/2)/this.cellSizeX,a=(e-this.center.z+this.physicalHeight/2)/this.cellSizeZ,h=i/Math.min(this.cellSizeX,this.cellSizeZ),n=h*h,r=Math.max(0,Math.floor(s-h)),l=Math.min(this.numCellsX-1,Math.ceil(s+h)),c=Math.max(0,Math.floor(a-h)),o=Math.min(this.numCellsZ-1,Math.ceil(a+h)),d=r;d<=l;d++)for(var p=c;p<=o;p++){var u=d+.5-s,m=p+.5-a;u*u+m*m<=n&&this.harvestCell(d,p,!1)&&(this.instanceDataNeedsUpdate=!0)}this.instanceDataNeedsUpdate&&(this.instanceBuffer.setData(this.matrices),this.instanceDataNeedsUpdate=!1)};var CarMovement=pc.createScript("carMovement");CarMovement.attributes.add("speed",{type:"number",default:8,title:"Velocidad"}),CarMovement.attributes.add("turnSpeed",{type:"number",default:90,title:"Velocidad de giro"}),CarMovement.attributes.add("acceleration",{type:"number",default:5,title:"Factor de aceleraciÃ³n"}),CarMovement.attributes.add("wheel_left",{type:"entity"}),CarMovement.attributes.add("wheel_right",{type:"entity"}),CarMovement.attributes.add("skins",{type:"json",array:!0,schema:[{name:"body",type:"entity"},{name:"cutter_side_a",type:"entity"},{name:"cutter_side_b",type:"entity"},{name:"cutter_segment",type:"asset"}]}),CarMovement.attributes.add("cutter_entity",{type:"entity"}),CarMovement.prototype.initialize=function(){CarMovement.instance=this,this.allow_input=!0,this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.keyboard.on(pc.EVENT_KEYUP,this.onKeyUp,this),this.moveForward=!1,this.moveBackward=!1,this.turnLeft=!1,this.turnRight=!1,this.skin_index=parseInt(GameManager.instance.loadString("skin","0")),this.currentSpeed=0,this.entity.collision&&this.entity.collision.on("collisionstart",this.onCollisionStart,this),CarMovement.volume=0,CarMovement.volume_to=0,this.cutter_entity.script.cutter.init(),this.changeSkin(this.skin_index),window.addEventListener("blur",function(){this.moveForward=!1,this.moveBackward=!1,this.turnLeft=!1,this.turnRight=!1}.bind(this))},CarMovement.prototype.changeSkin=function(e){this.skin_index=e;for(let e=0;e<this.skins.length;e++)this.skins[e].body.enabled=!1,this.skins[e].cutter_side_a.enabled=!1,this.skins[e].cutter_side_b.enabled=!1;this.skins[e].body.enabled=!0,this.skins[e].cutter_side_a.enabled=!0,this.skins[e].cutter_side_b.enabled=!0,Cutter.instance.updateSegments()},CarMovement.prototype.update=function(e){let t=0,i=0;this.moveForward||Controls.instance.up?t=-1:(this.moveBackward||Controls.instance.down)&&(t=1),this.turnLeft||Controls.instance.left?i=1:(this.turnRight||Controls.instance.right)&&(i=-1),t<=0&&(i=-i);let n=1+UpgradeScreen.instance.speed_level/6;this.allow_input||(t=0,i=0);var a=t*this.speed*n;this.currentSpeed=pc.math.lerp(this.currentSpeed,a,this.acceleration*e),SoundManager.instance.setPitch("engine_loop",.4+Math.abs(this.currentSpeed)/90);var s=this.entity.forward.clone().scale(this.currentSpeed),r=this.entity.rigidbody.linearVelocity.clone(),o=new pc.Vec3;o.sub2(s,r);var c=o.scale(this.entity.rigidbody.mass*this.acceleration);this.entity.rigidbody.applyForce(c);var h=-i*this.turnSpeed*.5*n;this.entity.rigidbody.applyTorque(new pc.Vec3(0,h,0));let l=20*i,d=this.wheel_right.getLocalEulerAngles(),p=pc.math.lerpAngle(d.y,l,8*e);this.wheel_left.setLocalEulerAngles(0,-p,0),this.wheel_right.setLocalEulerAngles(0,p,180),CarMovement.volume=pc.math.lerp(CarMovement.volume,CarMovement.volume_to,5*e),CarMovement.volume_to=0,SoundManager.instance.setVolume("cutting_loop",.25*CarMovement.volume)},CarMovement.prototype.onCollisionStart=function(e){this.currentSpeed=0},CarMovement.prototype.onKeyDown=function(e){switch(e.key){case pc.KEY_W:case pc.KEY_UP:this.moveForward=!0;break;case pc.KEY_S:case pc.KEY_DOWN:this.moveBackward=!0;break;case pc.KEY_A:case pc.KEY_LEFT:this.turnLeft=!0;break;case pc.KEY_D:case pc.KEY_RIGHT:this.turnRight=!0}},CarMovement.prototype.onKeyUp=function(e){switch(e.key){case pc.KEY_W:case pc.KEY_UP:this.moveForward=!1;break;case pc.KEY_S:case pc.KEY_DOWN:this.moveBackward=!1;break;case pc.KEY_A:case pc.KEY_LEFT:this.turnLeft=!1;break;case pc.KEY_D:case pc.KEY_RIGHT:this.turnRight=!1}};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("target_focus",{type:"entity"}),CameraMovement.attributes.add("target_position",{type:"entity"}),CameraMovement.attributes.add("target_position2",{type:"entity"}),CameraMovement.prototype.initialize=function(){this.entity.setPosition(this.target_position.getPosition()),this.current_target=this.target_position},CameraMovement.prototype.postUpdate=function(t){this.entity.setPosition((new pc.Vec3).lerp(this.entity.getPosition(),this.current_target.getPosition(),8*t)),this.entity.lookAt(this.target_focus.getPosition())};pc.script.createLoadingScreen((function(e){e.p=!0,window.addEventListener("keydown",(e=>{["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"," "].includes(e.key)&&e.preventDefault()})),window.addEventListener("wheel",(e=>e.preventDefault()),{passive:!1}),e.p&&(PokiSDK.init().then((()=>{e.ab=!1})).catch((()=>{e.ab=!0})),PokiSDK.gameLoadingStart());var a,t;a=["body {","    background-color: #70a1eb;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","background: ","conic-gradient(","from 0deg,","transparent 0deg,","transparent 15deg,","rgba(0,116,255,1) 15deg,","rgba(0,116,255,1) 30deg,","transparent 30deg,","transparent 45deg,","rgba(0,116,255,1) 45deg,","rgba(0,116,255,1) 60deg,","transparent 60deg,","transparent 75deg,","rgba(0,116,255,1) 75deg,","rgba(0,116,255,1) 90deg,","transparent 90deg,","transparent 105deg,","rgba(0,116,255,1) 105deg,","rgba(0,116,255,1) 120deg,","transparent 120deg,","transparent 135deg,","rgba(0,116,255,1) 135deg,","rgba(0,116,255,1) 150deg,","transparent 150deg,","transparent 165deg,","rgba(0,116,255,1) 165deg,","rgba(0,116,255,1) 180deg,","transparent 180deg,","transparent 195deg,","rgba(0,116,255,1) 195deg,","rgba(0,116,255,1) 210deg,","transparent 210deg,","transparent 225deg,","rgba(0,116,255,1) 225deg,","rgba(0,116,255,1) 240deg,","transparent 240deg,","transparent 255deg,","rgba(0,116,255,1) 255deg,","rgba(0,116,255,1) 270deg,","transparent 270deg,","transparent 285deg,","rgba(0,116,255,1) 285deg,","rgba(0,116,255,1) 300deg,","transparent 300deg,","transparent 315deg,","rgba(0,116,255,1) 315deg,","rgba(0,116,255,1) 330deg,","transparent 330deg,","transparent 345deg,","rgba(0,116,255,1) 345deg,","rgba(0,116,255,1) 360deg","),","radial-gradient(circle, rgba(147,237,255,1), rgba(0,116,255,1));","background-blend-mode: screen;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 40px);","    width: 64px;","    left: calc(50% - 32px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #AABBFF;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #fff;","}"].join("\n"),(t=document.createElement("style")).type="text/css",t.styleSheet?t.styleSheet.cssText=a:t.appendChild(document.createTextNode(a)),document.head.appendChild(t),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var a=document.createElement("div");a.id="application-splash",e.appendChild(a),a.style.display="none";var t=document.createElement("img");t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAA3CAYAAABKB8k/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAGj2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDM2LCAyMDE5LzA4LzEzLTAxOjA2OjU3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI1LTA3LTE3VDE1OjI4OjA1LTAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI1LTA3LTE3VDE1OjI4OjA1LTAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNS0wNy0xN1QxNToyODowNS0wMzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpiNGQwNmE4MS1jZDZhLTM5NDEtYTFiNC0xNzUxMjI0YmUxZWMiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo3ZjM2NTMzYS1kMjNjLTc0NDAtOTMyMy0zZjlhZTAwMDgyYzUiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1ODZmOWMyYy0xZmM4LTE4NDQtOTlkOC05ZjgwY2MzNzcwMWIiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjU4NmY5YzJjLTFmYzgtMTg0NC05OWQ4LTlmODBjYzM3NzAxYiIgc3RFdnQ6d2hlbj0iMjAyNS0wNy0xN1QxNToyODowNS0wMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiNGQwNmE4MS1jZDZhLTM5NDEtYTFiNC0xNzUxMjI0YmUxZWMiIHN0RXZ0OndoZW49IjIwMjUtMDctMTdUMTU6Mjg6MDUtMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPHBob3Rvc2hvcDpEb2N1bWVudEFuY2VzdG9ycz4gPHJkZjpCYWc+IDxyZGY6bGk+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjFkNjA3N2I5LTc0NjAtMzA0Ny1hNWM4LWM4YzgxNzhlNDBmODwvcmRmOmxpPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqhiTQAAAAShSURBVGje3ZptiFRVGMfvndnd2WlFy9fNQtdCCV9ao00tUno1yCKJKCVSkLCCwg9r7EISUhgFgmzMkiRJtDTIQhBiCCKL0ZcIMSIkDIk+RDhISMiyiCy/vvwvHU7n3L0zd+7MbR+4MMy95zznf87z/pwACDJ6bgPeAt4A5mXFJ6vFF4AD/EtDQPh/AtABjBkAjgHFPAIIgU4PgE8NABUPgM60J5Nm8SVgrxa6RWITvStaAEYtAEXgEX2zB+hqB4AnjQVeB/YBZUMHbAARwB5gEJg03j/cDgBP81/6ElikHT5s/P+hACwBxh3jHs0SQCiT2GP93w0cBKatxZwDnhOYiD4HtgPfWd/elLXqtua+RaY3TAsgBLYCPwOngGUOZX0RuOLY1eue3xH9CTyvOcw5+4CTwHlgc1oAZeBbg+mgY1dCoB+YIDmdAe71zDVsfHdaxiIVgLPGhIdj7PkC4OMEiz8CzI/xH+Yc36QFUASOGhMe99j96OmSWbzqWPgVYFeC8abujFjm2QtgIfC45C+0jvRda0fKCfTmIeCyMe4SsCmBUvZYojjsWM/dwGPRKQbAXMnaNPA78Lr+iwa9akz4U8zx2yd3zBj3ScJQYpHARrTLeHcr8Cbwh6zXSWBOIEQ2TQAbxNR0WDVgecJgbrQeUdBzF/CX5R+KwIMyzzatiOx5xfFyUnb+kBAD3ADWJjyBuFDC96w3eN0E3gfeE1+XMSiZjuMV2XsXmc5qU4YAtnh4YonxzkgXbeVbJrf/d4wZ3JYhgO0xfK9JGu40FdvHfKM8oYvGgdszAHAH8JWH5/fAA645Ak+Mfp8jbjHponar1AQA3cALwC8x/M5JPzp9AEKgF3hJJrXmURybqlLqQgMACgonxhPwuaE1ndYaeyMxChT1DQG/xSjwhOTPZcquAvst/1CMyQeisGNYcu0y4REvnyJfBt4G5gYyVS6qaYe3CmRBixz0RJ8/6NsOfTtivPtIO9ahPOK8Jzrdp9A9lON6Cjhh+QaTDgRWrIMmHwZWe2S8ILGpeiY9BNwPfGH89xkwICCuEx4Tv4JHR9YA7wAXrLEjAbBSAVQV2AEsTug1y1LkHz2BW806TdepXQCedSQ0Pu++RD7ghDZohZmglxpM63rlsafqyAemFCQubrASUooKAc2qzxSV1ByfwXpNSZz6E55yywtb91hhtE2XgFV5rMzVewLrmn0CrdaByRQ6EFmmUgRgpcxYVV4u71Zoh6xQFVgVKFtqth8YaJEfOBooYcibJy4k9MQH2xkLDXkWVk8sNG9WRKN5yQcupskHbOYbJNO+jGxpBhnZ0hkysoGZMrIsc+JK1jlxXqoSmy2e056qxMtmVSJPdaH+RupCvsrcxiZW5o5kVJnrc9VGX7Ma082ojSY9gXproz2zojqd5/7AjKKX9w7NqWa0mEyPvN/T11rfQI9sXSt6ZCHwDPCrmPZ5upQ1h99otEu5HPhakUDqLmUEYgEwx3E6cX3isRR94rKsY0iGOfG2Ojr1H7SzU+97nqjjrkQlj3cluuTkktxWqcTcVtndrtsq9dwXGs3jfaFZcWNr1t6Za9mtxX8A4pMvUX6bERAAAAAOZVhJZk1NACoAAAAIAAAAAAAAANJTkwAAAABJRU5ErkJggg==",a.appendChild(t),t.onload=function(){a.style.display="block"};var d=document.createElement("div");d.id="progress-bar-container",a.appendChild(d);var g=document.createElement("div");g.id="progress-bar",d.appendChild(g)}(),e.on("preload:end",(function(){e.p&&PokiSDK.gameLoadingFinished(),e.off("preload:progress")})),e.on("preload:progress",(function(e){var a=document.getElementById("progress-bar");a&&(e=Math.min(1,Math.max(0,e)),a.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var AdsManager=pc.createScript("adsManager");AdsManager.prototype.initialize=function(){AdsManager.instance=this,this.adActive=!1,AdsManager.gameplay=!1,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.inputDown,this),this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,this.inputDown,this)},AdsManager.prototype.inputDown=function(t){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.inputDown,this),this.app.touch&&this.app.touch.off(pc.EVENT_TOUCHSTART,this.inputDown,this),this.gameplayStart()},AdsManager.prototype.update=function(t){},AdsManager.prototype.showCommercialBreak=function(t=null){this.app.p?(this.app.systems.sound.volume=0,this.adActive=!0,this.app.timeScale=0,PokiSDK.commercialBreak().then(function(){this.adActive=!1,this.app.systems.sound.volume=1,this.app.timeScale=1,t&&t()}.bind(this))):t&&t()},AdsManager.prototype.showRewardedBreak=function(t=null){this.app.p?(this.app.systems.sound.volume=0,this.adActive=!0,this.app.timeScale=0,PokiSDK.rewardedBreak().then(function(a){this.adActive=!1,this.app.systems.sound.volume=1,this.app.timeScale=1,t&&t(a)}.bind(this))):t&&t(!1)},AdsManager.prototype.gameplayStart=function(){AdsManager.gameplay||(AdsManager.gameplay=!0,this.app.p&&(PokiSDK.gameplayStart(),console.log("start")))},AdsManager.prototype.gameplayStop=function(){AdsManager.gameplay&&(AdsManager.gameplay=!1,this.app.p&&(PokiSDK.gameplayStop(),console.log("stop")))};var HarvestCircle=pc.createScript("harvestCircle");HarvestCircle.attributes.add("radius",{type:"number"}),HarvestCircle.prototype.initialize=function(){this.app.once("do_harvest",function(){for(let t=0;t<Harvest.all_harvest.length;t++)Harvest.all_harvest[t].harvestInArea(this.entity.getPosition().x,this.entity.getPosition().z,this.radius);this.enabled=!1}.bind(this))},HarvestCircle.prototype.update=function(t){if(Harvest.all_harvest){for(let t=0;t<Harvest.all_harvest.length;t++)Harvest.all_harvest[t].harvestInArea(this.entity.getPosition().x,this.entity.getPosition().z,this.radius);this.enabled=!1}else console.log("wait another frame")};var HarvestRectangle=pc.createScript("harvestRectangle");HarvestRectangle.attributes.add("w",{type:"number"}),HarvestRectangle.attributes.add("h",{type:"number"}),HarvestRectangle.prototype.initialize=function(){this.app.once("do_harvest",function(){for(let t=0;t<Harvest.all_harvest.length;t++)Harvest.all_harvest[t].harvestInRect(this.entity.getPosition().x,this.entity.getPosition().z,this.w,this.h,0,!1);this.enabled=!1}.bind(this))},HarvestRectangle.prototype.update=function(t){};var Controls=pc.createScript("controls");Controls.attributes.add("button_left",{type:"entity"}),Controls.attributes.add("button_right",{type:"entity"}),Controls.attributes.add("button_up",{type:"entity"}),Controls.attributes.add("button_down",{type:"entity"}),Controls.attributes.add("button_left_l",{type:"entity"}),Controls.attributes.add("button_right_l",{type:"entity"}),Controls.attributes.add("button_up_l",{type:"entity"}),Controls.attributes.add("button_down_l",{type:"entity"}),Controls.attributes.add("screen_portrait",{type:"entity"}),Controls.attributes.add("screen_landscape",{type:"entity"}),Controls.prototype.initialize=function(){Controls.instance=this,this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.show_on_pc=!1,this.up_from_button=!1,this.button_left&&(this.button_left.enabled=pc.platform.touch||this.show_on_pc,this.button_left.button.on("pressedstart",(function(){this.left=!0}),this),this.button_left.button.on("pressedend",(function(){this.left=!1}),this)),this.button_left_l&&(this.button_left_l.enabled=pc.platform.touch||this.show_on_pc,this.button_left_l.button.on("pressedstart",(function(){this.left=!0}),this),this.button_left_l.button.on("pressedend",(function(){this.left=!1}),this)),this.button_right&&(this.button_right.enabled=pc.platform.touch||this.show_on_pc,this.button_right.button.on("pressedstart",(function(){this.right=!0}),this),this.button_right.button.on("pressedend",(function(){this.right=!1}),this)),this.button_right_l&&(this.button_right_l.enabled=pc.platform.touch||this.show_on_pc,this.button_right_l.button.on("pressedstart",(function(){this.right=!0}),this),this.button_right_l.button.on("pressedend",(function(){this.right=!1}),this)),this.button_up&&(this.button_up.enabled=pc.platform.touch||this.show_on_pc,this.button_up.button.on("pressedstart",(function(){this.up=!0}),this),this.button_up.button.on("pressedend",(function(){this.up=!1}),this)),this.button_up_l&&(this.button_up_l.enabled=pc.platform.touch||this.show_on_pc,this.button_up_l.button.on("pressedstart",(function(){this.up=!0}),this),this.button_up_l.button.on("pressedend",(function(){this.up=!1}),this)),this.button_down&&(this.button_down.enabled=pc.platform.touch||this.show_on_pc,this.button_down.button.on("pressedstart",(function(){this.down=!0}),this),this.button_down.button.on("pressedend",(function(){this.down=!1}),this)),this.button_down_l&&(this.button_down_l.enabled=pc.platform.touch||this.show_on_pc,this.button_down_l.button.on("pressedstart",(function(){this.down=!0}),this),this.button_down_l.button.on("pressedend",(function(){this.down=!1}),this))},Controls.prototype.showMobileControls=function(){pc.platform.touch&&(this.button_left.enabled=!0,this.button_right.enabled=!0,this.button_up.enabled=!0,this.button_down.enabled=!0)},Controls.prototype.hideMobileControls=function(){pc.platform.touch&&(this.button_left.enabled=!1,this.button_right.enabled=!1,this.button_up.enabled=!1,this.button_down.enabled=!1)},Controls.prototype.update=function(t){let n=window.innerWidth>window.innerHeight;this.screen_portrait.enabled=!n,this.screen_landscape.enabled=n};var FovAspectRatio=pc.createScript("fovAspectRatio");FovAspectRatio.attributes.add("fov_landscape",{type:"number"}),FovAspectRatio.attributes.add("fov_portrait",{type:"number"}),FovAspectRatio.prototype.initialize=function(){},FovAspectRatio.prototype.update=function(t){window.innerWidth>window.innerHeight?this.entity.camera.fov=this.fov_landscape:this.entity.camera.fov=this.fov_portrait};var RadialBar=pc.createScript("radialBar");RadialBar.attributes.add("bar_mask",{type:"entity"}),RadialBar.attributes.add("bar",{type:"entity"}),RadialBar.attributes.add("text_entity",{type:"entity"}),RadialBar.attributes.add("icon_entity",{type:"entity"}),RadialBar.prototype.initialize=function(){this.progress=0},RadialBar.prototype.setProgress=function(t){this.progress=t},RadialBar.prototype.update=function(t){this.bar_mask.element.height=70*this.progress,this.text_entity.element.text=Math.floor(100*this.progress)+"%"};var Trunk=pc.createScript("trunk");Trunk.attributes.add("bar",{type:"entity"}),Trunk.attributes.add("text_entity",{type:"entity"}),Trunk.attributes.add("pile",{type:"entity"}),Trunk.attributes.add("cutter",{type:"entity"}),Trunk.prototype.initialize=function(){this.max_capacity=1e3,this.current=0,Trunk.instance=this,this.empty_first_flag=!1},Trunk.prototype.update=function(t){this.max_capacity=2e3+1e3*(UpgradeScreen.instance.capacity_level-1);var e=this.current/this.max_capacity;e>=1?(Arrow.instance.showToBarn(),this.bar.element.height=240,this.text_entity.element.text="FULL",this.pile.setLocalPosition(0,2,-5),this.pile.setLocalScale(1.8,2,1.8),this.cutter.script.cutter.toggle(!1)):(e>0&&(this.empty_first_flag=!1),this.bar.element.height=240*e,this.text_entity.element.text=Math.floor(100*e)+"%",this.pile.setLocalPosition(0,pc.math.lerp(1.8,2,e),-5),this.pile.setLocalScale(1.8,2*e,1.8),this.cutter.script.cutter.toggle(!0))},Trunk.prototype.removeCargo=function(t){let e=Math.min(t,this.current);return this.current-=e,this.current<=0&&(this.empty_first_flag||(this.empty_first_flag=!0,AdsManager.instance.gameplayStop(),AdsManager.instance.showCommercialBreak(function(){AdsManager.instance.gameplayStart()}.bind(this)))),e};var Cutter=pc.createScript("cutter");Cutter.attributes.add("side_left",{type:"entity"}),Cutter.attributes.add("side_right",{type:"entity"}),Cutter.attributes.add("segment",{type:"asset"}),Cutter.attributes.add("sub_cont",{type:"entity"}),Cutter.attributes.add("car",{type:"entity"}),Cutter.prototype.init=function(){Cutter.instance=this,this.segments=[],this.amount=0,this.is_down=!0,this.car_script=this.car.script.carMovement},Cutter.prototype.update=function(t){},Cutter.prototype.toggle=function(t){if(this.is_down==t)return;this.is_down=t,this.cont={value:0};let e=this.entity.tween(this.cont).to({value:1},.5,pc.CubicInOut),s=this.is_down?-60:0,i=this.is_down?0:-60;e.on("update",function(){let t=pc.math.lerp(s,i,this.cont.value);this.entity.setLocalEulerAngles(t,0,0)}.bind(this)),e.start()},Cutter.prototype.updateSegments=function(){this.spawnSegements(this.amount)},Cutter.prototype.spawnSegements=function(t){this.amount=t;for(let t=0;t<this.segments.length;t++)this.segments[t].destroy();this.segments=[];for(let e=0;e<t;e++){let s=this.car_script.skins[this.car_script.skin_index].cutter_segment.resource.instantiate();this.sub_cont.addChild(s),s.setLocalPosition(e+.5-t/2,0,0),this.segments.push(s)}this.side_left.setLocalPosition(-t/2,0,0),this.side_right.setLocalPosition(t/2,0,0),this.entity.collision.halfExtents=new pc.Vec3(t/2,1.5,1.8)};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,s))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var Barn=pc.createScript("barn");Barn.prototype.initialize=function(){Barn.instance=this,this.entity.collision.on("triggerenter",this.onEnter,this),this.entity.collision.on("triggerleave",this.onLeave,this),this.inside=!1,this.first_time=!0},Barn.prototype.onEnter=function(){this.inside=!0},Barn.prototype.onLeave=function(){this.inside=!1,GameManager.instance.money>=20&&this.first_time&&(this.first_time=!1,Arrow.instance.showToUpgrades())},Barn.prototype.update=function(t){if(this.inside){Arrow.instance.target==this.entity&&(Arrow.instance.target=null);let t=Trunk.instance.removeCargo(Math.max(5,Trunk.instance.current/40));GameManager.instance.addMoney(t/100)}};var ChangeCamera=pc.createScript("changeCamera");ChangeCamera.attributes.add("camera_entity",{type:"entity"}),ChangeCamera.attributes.add("text",{type:"entity"}),ChangeCamera.prototype.initialize=function(){this.cm=this.camera_entity.script.cameraMovement,this.entity.button.on("click",(function(){this.swapCamera()}),this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.touch&&(this.text.enabled=!1)},ChangeCamera.prototype.onKeyDown=function(t){this&&t.key===pc.KEY_E&&this.swapCamera()},ChangeCamera.prototype.swapCamera=function(){this.cm.current_target==this.cm.target_position?this.cm.current_target=this.cm.target_position2:this.cm.current_target=this.cm.target_position};var UpgradeScreen=pc.createScript("upgradeScreen");UpgradeScreen.attributes.add("cont",{type:"entity"}),UpgradeScreen.attributes.add("close_button",{type:"entity"}),UpgradeScreen.attributes.add("spread_button",{type:"entity"}),UpgradeScreen.attributes.add("capacity_button",{type:"entity"}),UpgradeScreen.attributes.add("speed_button",{type:"entity"}),UpgradeScreen.attributes.add("spread_text",{type:"entity"}),UpgradeScreen.attributes.add("capacity_text",{type:"entity"}),UpgradeScreen.attributes.add("speed_text",{type:"entity"}),UpgradeScreen.attributes.add("spread_button_yellow",{type:"entity"}),UpgradeScreen.attributes.add("capacity_button_yellow",{type:"entity"}),UpgradeScreen.attributes.add("speed_button_yellow",{type:"entity"}),UpgradeScreen.attributes.add("spread_lvl_text",{type:"entity"}),UpgradeScreen.attributes.add("capacity_lvl_text",{type:"entity"}),UpgradeScreen.attributes.add("speed_lvl_text",{type:"entity"}),UpgradeScreen.attributes.add("spread_ad_button",{type:"entity"}),UpgradeScreen.attributes.add("capacity_ad_button",{type:"entity"}),UpgradeScreen.attributes.add("speed_ad_button",{type:"entity"}),UpgradeScreen.attributes.add("skin_01_button",{type:"entity"}),UpgradeScreen.attributes.add("skin_02_button",{type:"entity"}),UpgradeScreen.attributes.add("skin_03_button",{type:"entity"}),UpgradeScreen.attributes.add("skin_02_ad_button",{type:"entity"}),UpgradeScreen.attributes.add("skin_03_ad_button",{type:"entity"}),UpgradeScreen.attributes.add("selected_01",{type:"entity"}),UpgradeScreen.attributes.add("selected_02",{type:"entity"}),UpgradeScreen.attributes.add("selected_03",{type:"entity"}),UpgradeScreen.attributes.add("reset_progress_button",{type:"entity"}),UpgradeScreen.attributes.add("reset_progress_popup",{type:"entity"}),UpgradeScreen.attributes.add("button_yes",{type:"entity"}),UpgradeScreen.attributes.add("button_no",{type:"entity"}),UpgradeScreen.attributes.add("close_pop_up_button",{type:"entity"}),UpgradeScreen.prototype.initialize=function(){UpgradeScreen.instance=this,this.cont.enabled=!1,this.cooldown=.5,this.spread_ad_watched=!1,this.capacity_ad_watched=!1,this.speed_ad_watched=!1,this.reset_progress_popup.enabled=!1,this.close_button.button.on("click",(function(){this.hide()}),this),this.spread_level=Number(GameManager.instance.loadString("spread_level",1)),this.capacity_level=Number(GameManager.instance.loadString("capacity_level",1)),this.speed_level=Number(GameManager.instance.loadString("speed_level",1)),Cutter.instance.spawnSegements(5+this.spread_level),this.spread_cost=0,this.capacity_cost=0,this.speed_cost=0,this.max_spread_level=10,this.spread_button.button.on("click",(function(){this.spread_level>=this.max_spread_level||this.spread_ad_watched||this.handleUpgrade(this.spread_cost,function(e){this.spread_level++,e&&(this.spread_ad_watched=!0),Cutter.instance.spawnSegements(5+this.spread_level),GameManager.instance.saveString("spread_level",this.spread_level)}.bind(this))}),this),this.capacity_button.button.on("click",(function(){this.capacity_ad_watched||this.handleUpgrade(this.capacity_cost,function(e){e&&(this.capacity_ad_watched=!0),this.capacity_level++,GameManager.instance.saveString("capacity_level",this.capacity_level)}.bind(this))}),this),this.speed_button.button.on("click",(function(){this.speed_ad_watched||this.handleUpgrade(this.speed_cost,function(e){e&&(this.speed_ad_watched=!0),this.speed_level++,GameManager.instance.saveString("speed_level",this.speed_level)}.bind(this))}),this),this.current_skin=CarMovement.instance.skin_index,this.skin_02_ad_watched="true"==GameManager.instance.loadString("skin_02",""),this.skin_03_ad_watched="true"==GameManager.instance.loadString("skin_03",""),this.skin_01_button.button.on("click",(function(){this.updateSkin(0)}),this),this.skin_02_button.button.on("click",(function(){this.skin_02_ad_watched?this.updateSkin(1):this.handleSkinClick(function(e){e&&(this.skin_02_ad_watched=!0,GameManager.instance.saveString("skin_02","true"),this.updateSkin(1))}.bind(this))}),this),this.skin_03_button.button.on("click",(function(){this.skin_03_ad_watched?this.updateSkin(2):this.handleSkinClick(function(e){e&&(this.skin_03_ad_watched=!0,GameManager.instance.saveString("skin_03","true"),this.updateSkin(2))}.bind(this))}),this),this.reset_progress_button.button.on("click",(function(){this.cont.enabled=!1,this.reset_progress_popup.enabled=!0}),this),this.button_yes.button.on("click",(function(){this.onDeleteProgress()}),this),this.button_no.button.on("click",(function(){this.cont.enabled=!0,this.reset_progress_popup.enabled=!1}),this),this.close_pop_up_button.button.on("click",(function(){this.cont.enabled=!0,this.reset_progress_popup.enabled=!1}),this)},UpgradeScreen.prototype.onDeleteProgress=function(){SoundManager.instance.removeListeners(),UpgradeScreen.instance=null,Cutter.instance=null,Trunk.instance=null,Fade.instance=null,SoundManager.instance=null,Barn.instance=null,Controls.instance=null,Arrow.instance.target=null,CarMovement.instance=null,CompleteMessage.instance=null,GameManager.instance.clearSaves(),this.skin_02_ad_watched&&GameManager.instance.saveString("skin_02","true"),this.skin_03_ad_watched&&GameManager.instance.saveString("skin_03","true"),GameManager.instance=null,AdsManager.instance.gameplayStart(),AdsManager.instance=null,this.app.root.destroy(),this.app.scenes.changeScene("SnowPlow")},UpgradeScreen.prototype.updateSkin=function(e){this.current_skin=e,GameManager.instance.saveString("skin",e),CarMovement.instance.changeSkin(e),this.updateButtons()},UpgradeScreen.prototype.handleSkinClick=function(e){AdsManager.instance.adActive||AdsManager.instance.showRewardedBreak(function(t){t&&(e(!0),SoundManager.instance.playSound("register"),this.updateButtons())}.bind(this))},UpgradeScreen.prototype.handleUpgrade=function(e,t){GameManager.instance.money>=e?(GameManager.instance.addMoney(-e),t(!1),SoundManager.instance.playSound("register"),this.updateButtons()):AdsManager.instance.adActive||AdsManager.instance.showRewardedBreak(function(e){e&&(t(!0),SoundManager.instance.playSound("register"),this.updateButtons())}.bind(this))},UpgradeScreen.prototype.update=function(e){this.cooldown-=e,!AdsManager.instance.adActive&&this.app.keyboard.isPressed(pc.KEY_ESCAPE)&&this.hide()},UpgradeScreen.prototype.show=function(){this.cooldown>0||(this.cont.enabled=!0,this.spread_ad_watched=!1,this.capacity_ad_watched=!1,this.speed_ad_watched=!1,this.updateButtons(),Barn.instance.first_time=!1,AdsManager.instance.gameplayStop())},UpgradeScreen.prototype.hide=function(){this.cooldown>0||(this.cont.enabled=!1,AdsManager.instance.gameplayStart(),this.reset_progress_popup.enabled=!1)},UpgradeScreen.prototype.updateButtons=function(){this.spread_cost=20*this.spread_level,this.spread_text.element.text=this.spread_cost,this.spread_button_yellow.enabled=GameManager.instance.money>=this.spread_cost,this.spread_ad_button.enabled=!this.spread_button_yellow.enabled,this.spread_lvl_text.element.text="lvl"+this.spread_level,this.spread_ad_button.element.opacity=this.spread_ad_watched?.2:1,this.spread_level>=this.max_spread_level&&(this.spread_ad_button.enabled=!1,this.spread_button_yellow.enabled=!1),this.speed_cost=20*this.speed_level,this.speed_text.element.text=this.speed_cost,this.speed_button_yellow.enabled=GameManager.instance.money>=this.speed_cost,this.speed_ad_button.enabled=!this.speed_button_yellow.enabled,this.speed_lvl_text.element.text="lvl"+this.speed_level,this.speed_ad_button.element.opacity=this.speed_ad_watched?.2:1,this.capacity_cost=20*this.capacity_level,this.capacity_text.element.text=this.capacity_cost,this.capacity_button_yellow.enabled=GameManager.instance.money>=this.capacity_cost,this.capacity_ad_button.enabled=!this.capacity_button_yellow.enabled,this.capacity_lvl_text.element.text="lvl"+this.capacity_level,this.capacity_ad_button.element.opacity=this.capacity_ad_watched?.2:1,this.skin_02_ad_button.enabled=!this.skin_02_ad_watched,this.skin_03_ad_button.enabled=!this.skin_03_ad_watched,this.selected_01.enabled=0==this.current_skin,this.selected_02.enabled=1==this.current_skin,this.selected_03.enabled=2==this.current_skin};var UpgradeArea=pc.createScript("upgradeArea");UpgradeArea.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onEnter,this),this.entity.collision.on("triggerleave",this.onLeave,this)},UpgradeArea.prototype.onEnter=function(e){Arrow.instance.target==this.entity&&(Arrow.instance.target=null),UpgradeScreen.instance.show()},UpgradeArea.prototype.onLeave=function(){UpgradeScreen.instance.hide()};var SoundManager=pc.createScript("soundManager");SoundManager.prototype.initialize=function(){SoundManager.instance=this,this.mute=!1,this.start_volume=this.entity.sound.volume,this.app.on("mute_down",this.toggleMute.bind(this))},SoundManager.prototype.toggleMute=function(){this.entity.sound&&(this.mute=!this.mute,this.entity.sound.volume=this.mute?0:this.start_volume)},SoundManager.prototype.playSound=function(t,n=0){setTimeout(function(){this.entity.sound.play(t)}.bind(this),1e3*n)},SoundManager.prototype.setVolume=function(t,n){this.entity.sound.slot(t).volume=n},SoundManager.prototype.setPitch=function(t,n){this.entity.sound.slot(t).pitch=n},SoundManager.prototype.removeListeners=function(){this.app.off("mute_down",this.toggleMute)};var MuteButton=pc.createScript("muteButton");MuteButton.attributes.add("on_icon",{type:"asset"}),MuteButton.attributes.add("off_icon",{type:"asset"}),MuteButton.attributes.add("icon_entity",{type:"entity"}),MuteButton.attributes.add("text",{type:"entity"}),MuteButton.prototype.initialize=function(){this.icon_entity.element.sprite=SoundManager.instance.mute?this.off_icon.resource:this.on_icon.resource,this.entity.button.on("click",function(){this.onMute()}.bind(this)),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.touch&&(this.text.enabled=!1)},MuteButton.prototype.onKeyDown=function(t){this&&t.key===pc.KEY_M&&this.onMute()},MuteButton.prototype.onMute=function(){this.icon_entity.element&&(this.app.fire("mute_down"),this.icon_entity.element.sprite=SoundManager.instance.mute?this.off_icon.resource:this.on_icon.resource)};var AvixRotate=pc.createScript("avixRotate");AvixRotate.attributes.add("speed",{type:"vec3"}),AvixRotate.attributes.add("speedRandom",{type:"vec3"}),AvixRotate.attributes.add("randomSignX",{type:"boolean"}),AvixRotate.attributes.add("randomSignY",{type:"boolean"}),AvixRotate.attributes.add("randomSignZ",{type:"boolean"}),AvixRotate.prototype.initialize=function(){this.signX=1,this.randomSignX&&Math.random()>.5&&(this.signX=-1),this.signY=1,this.randomSignY&&Math.random()>.5&&(this.signY=-1),this.signZ=1,this.randomSignZ&&Math.random()>.5&&(this.signZ=-1),this.currentRandomSpeed=new pc.Vec3(Math.random()*this.speedRandom.x,Math.random()*this.speedRandom.y,Math.random()*this.speedRandom.z)},AvixRotate.prototype.update=function(t){this.entity.rotateLocal((this.speed.x+this.currentRandomSpeed.x)*t*this.signX,(this.speed.y+this.currentRandomSpeed.y)*t*this.signY,(this.speed.z+this.currentRandomSpeed.z)*t*this.signZ)};var AvixSine=pc.createScript("avixSine");AvixSine.attributes.add("unscaled_update",{type:"boolean"}),AvixSine.schemaSine=[{name:"enabled",type:"boolean",default:!1},{name:"wave",type:"string",default:"sine",enum:[{sine:"sine"},{triangle:"triangle"},{sawtooth:"sawtooth"},{reverseSawtooth:"reverseSawtooth"},{square:"square"}]},{name:"vector",type:"vec3"},{name:"vectorRandom",type:"vec3"},{name:"period",type:"number",default:4},{name:"periodRandom",type:"number",default:0},{name:"periodOffset",type:"number",default:0},{name:"periodOffsetRandom",type:"number",default:0},{name:"magnitude",type:"number",default:1},{name:"magnitudeRandom",type:"number",default:0}],AvixSine.attributes.add("sineScale",{type:"json",schema:AvixSine.schemaSine}),AvixSine.attributes.add("sinePosition",{type:"json",schema:AvixSine.schemaSine}),AvixSine.attributes.add("sineAngle",{type:"json",schema:AvixSine.schemaSine}),AvixSine.prototype.initialize=function(){this._2pi=2*Math.PI,this._pi_2=Math.PI/2,this._3pi_2=3*Math.PI/2,this.sineScale.movement="scale",this.sinePosition.movement="position",this.sineAngle.movement="angle",this.sineScaleNew=this.initSine(this.sineScale),this.sinePositionNew=this.initSine(this.sinePosition),this.sineAngleNew=this.initSine(this.sineAngle),this.app.on("frameupdate",this.unscaledUpdate,this)},AvixSine.prototype.initSine=function(e){let t={};switch(0==e.period?t.i=0:(t.i=e.periodOffset/e.period*this._2pi,t.i+=Math.random()*e.periodOffsetRandom/e.period*this._2pi),t.mag=Math.random()*e.magnitudeRandom,t.vectorRandom=new pc.Vec3(Math.random()*e.vectorRandom.x,Math.random()*e.vectorRandom.y,Math.random()*e.vectorRandom.z),t.periodRandom=Math.random()*e.periodRandom,t.initialValue=new pc.Vec3(0,0,0),e.movement){case"scale":t.initialValue=this.entity.getLocalScale().clone();break;case"position":t.initialValue=this.entity.getLocalPosition().clone();break;case"angle":t.initialValue=this.entity.getLocalEulerAngles().clone()}return t.lastKnownValue=t.initialValue,t.r=new pc.Vec3,t.r2=new pc.Vec3,t},AvixSine.prototype.update=function(e){this.unscaled_update||this.generalUpdate(e)},AvixSine.prototype.unscaledUpdate=function(e){this.unscaled_update&&this.enabled&&this.generalUpdate(e/1e3)},AvixSine.prototype.generalUpdate=function(e){this.updateSine(this.sineScaleNew,this.sineScale,e),this.updateSine(this.sinePositionNew,this.sinePosition,e),this.updateSine(this.sineAngleNew,this.sineAngle,e)},AvixSine.prototype.updateSine=function(e,t,i){if(!t.enabled)return;t.period+e.periodRandom==0?e.i=0:(e.i+=i/(t.period+e.periodRandom)*this._2pi,e.i=e.i%this._2pi);let n=this.waveFunc(t,e.i)*(t.magnitude+e.mag);if("scale"==t.movement){this.entity.getLocalScale().equals(e.lastKnownValue)||(e.r.sub2(this.entity.getLocalScale(),e.lastKnownValue),e.initialValue.add(e.r)),e.r.x=e.initialValue.x+(t.vector.x+e.vectorRandom.x)*n,e.r.y=e.initialValue.y+(t.vector.y+e.vectorRandom.y)*n,e.r.z=e.initialValue.z+(t.vector.z+e.vectorRandom.z)*n;let i=e.r.clone();this.entity.setLocalScale(i),e.lastKnownValue=this.entity.getLocalScale()}else if("position"==t.movement){this.entity.getLocalPosition().equals(e.lastKnownValue)||(e.r.sub2(this.entity.getLocalPosition().clone(),e.lastKnownValue),e.initialValue.add(e.r)),e.r.x=e.initialValue.x+(t.vector.x+e.vectorRandom.x)*n,e.r.y=e.initialValue.y+(t.vector.y+e.vectorRandom.y)*n,e.r.z=e.initialValue.z+(t.vector.z+e.vectorRandom.z)*n;let i=e.r.clone();this.entity.setLocalPosition(i),e.lastKnownValue=this.entity.getLocalPosition().clone()}else if("angle"==t.movement){this.entity.getLocalEulerAngles().equals(e.lastKnownValue)||(e.r.sub2(this.entity.getLocalEulerAngles().clone(),e.lastKnownValue),e.initialValue.add(e.r)),e.r.x=e.initialValue.x+(t.vector.x+e.vectorRandom.x)*n,e.r.y=e.initialValue.y+(t.vector.y+e.vectorRandom.y)*n,e.r.z=e.initialValue.z+(t.vector.z+e.vectorRandom.z)*n;let i=e.r.clone();this.entity.setLocalEulerAngles(i),e.lastKnownValue=this.entity.getLocalEulerAngles().clone()}},AvixSine.prototype.waveFunc=function(e,t){switch(t%=this._2pi,e.wave){case"sine":return Math.sin(t);case"triangle":return t<=this._pi_2?t/this._pi_2:t<=this._3pi_2?1-2*(t-this._pi_2)/Math.PI:(t-this._3pi_2)/this._pi_2-1;case"sawtooth":return 2*t/this._2pi-1;case"reverseSawtooth":return-2*t/this._2pi+1;case"square":return t<Math.PI?-1:1}return 0};var Arrow=pc.createScript("arrow");Arrow.attributes.add("target",{type:"entity"}),Arrow.attributes.add("my_arrow",{type:"entity"}),Arrow.attributes.add("sell_area",{type:"entity"}),Arrow.attributes.add("upgrade_area",{type:"entity"}),Arrow.prototype.initialize=function(){Arrow.instance=this,this.visible=!1,this.target=null},Arrow.prototype.update=function(t){if(null==this.target)return void(this.my_arrow.enabled=!1);let e=this.distanceXZ(this.entity.getPosition(),this.target.getPosition());e<20&&this.hide(),e>22&&this.show(),this.visible&&(this.entity.lookAt(this.target.getPosition()),this.entity.setEulerAngles(0,this.entity.getEulerAngles().y,0))},Arrow.prototype.showToBarn=function(){this.target=this.sell_area},Arrow.prototype.showToUpgrades=function(){this.target=this.upgrade_area},Arrow.prototype.hide=function(){if(!this.visible)return;this.visible=!1,this.cont={value:0};let t=this.entity.tween(this.cont).to({value:1},.25,pc.CubicInOut),e=new pc.Vec3(2,2,2),i=new pc.Vec3(0,0,0);t.on("update",function(){let t=(new pc.Vec3).lerp(e,i,this.cont.value);this.my_arrow.setLocalScale(t)}.bind(this)),t.on("complete",function(){this.my_arrow.enabled=!1}.bind(this)),t.start()},Arrow.prototype.show=function(){if(this.visible)return;this.visible=!0,this.my_arrow.enabled=!0,this.cont={value:0};let t=this.entity.tween(this.cont).to({value:1},.25,pc.CubicInOut),e=new pc.Vec3(0,0,0),i=new pc.Vec3(2,2,2);t.on("update",function(){let t=(new pc.Vec3).lerp(e,i,this.cont.value);this.my_arrow.setLocalScale(t)}.bind(this)),t.start()},Arrow.prototype.distanceXZ=function(t,e){var i=t.x-e.x,r=t.z-e.z;return Math.sqrt(i*i+r*r)};var CompleteMessage=pc.createScript("completeMessage");CompleteMessage.attributes.add("text_entity",{type:"entity"}),CompleteMessage.prototype.initialize=function(){CompleteMessage.instance=this,this.showing=!1},CompleteMessage.prototype.update=function(t){},CompleteMessage.prototype.showMessage=function(t){this.showing=!0,this.cont={value:0},this.entity.element.enabled=!0,this.entity.element.opacity=0,this.text_entity.enabled=!0,this.text_entity.setLocalPosition(-900,0,0);var e=this.entity.tween(this.cont).to({value:1},.5,pc.BackOut);e.on("update",function(t){this.entity.element.opacity=this.cont.value,this.text_entity.setLocalPosition(pc.math.lerp(-900,0,this.cont.value),0,0)}.bind(this)),e.on("complete",function(){this.showing=!1,AdsManager.instance.gameplayStop(),AdsManager.instance.showCommercialBreak()}.bind(this));var i=this.entity.tween(this.cont).to({value:0},.5,pc.BackOut);i.on("update",function(t){this.entity.element.opacity=this.cont.value,this.text_entity.setLocalPosition(pc.math.lerp(900,0,this.cont.value),0,0)}.bind(this)),i.on("complete",function(){this.showing=!1,t()}.bind(this)),e.delay(1).chain(i.delay(2)),e.start()};var Fade=pc.createScript("fade");Fade.prototype.initialize=function(){Fade.instance=this,this.entity.element.enabled=!0,this.entity.element.opacity=1,this.fadeOut()},Fade.prototype.fadeIn=function(t,e=null){this.entity.element.opacity=0,this.entity.element.enabled=!0,this.cont={value:0};var n=this.entity.tween(this.cont).to({value:1},.7,pc.Linear);n.on("update",function(t){this.entity.element.opacity=this.cont.value}.bind(this)),n.on("complete",function(){null!=e&&e()}.bind(this)),n.delay(t).start()},Fade.prototype.fadeOut=function(t,e=null){this.entity.element.opacity=1,this.entity.element.enabled=!0,this.cont={value:1};var n=this.entity.tween(this.cont).to({value:0},.7,pc.Linear);n.on("update",function(t){this.entity.element.opacity=this.cont.value}.bind(this)),n.on("complete",function(){null!=e&&e()}.bind(this)),n.delay(t).start()};var SnowDisplacement=pc.createScript("snowDisplacement");SnowDisplacement.attributes.add("displacementCamera",{type:"entity",description:"CÃ¡mara ortogrÃ¡fica que genera el mapa de altura"}),SnowDisplacement.attributes.add("displacementResolution",{type:"number",default:512}),SnowDisplacement.attributes.add("displacementStrength",{type:"number",default:.5}),SnowDisplacement.prototype.initialize=function(){var e=this.app;this.rt=new pc.RenderTarget({colorBuffer:new pc.Texture(e.graphicsDevice,{width:this.displacementResolution,height:this.displacementResolution,format:pc.PIXELFORMAT_R8_G8_B8_A8,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR}),depth:!0}),this.displacementCamera.camera.renderTarget=this.rt,this.createMaterial()},SnowDisplacement.prototype.createMaterial=function(){var e=this.app,t=new pc.Shader(e.graphicsDevice,{attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:"\n        attribute vec3 aPosition;\n        attribute vec2 aUv0;\n\n        uniform mat4 matrix_model;\n        uniform mat4 matrix_viewProjection;\n\n        uniform sampler2D uDisplacementMap;\n        uniform float uDisplacementStrength;\n\n        varying vec2 vUv;\n\n        void main(void) {\n            vUv = aUv0;\n            float height = texture2D(uDisplacementMap, aUv0).r;\n            vec3 pos = aPosition;\n            pos.y += height * uDisplacementStrength;\n            gl_Position = matrix_viewProjection * matrix_model * vec4(pos, 1.0);\n        }\n    ",fshader:"\n        precision mediump float;\n\n        varying vec2 vUv;\n\n        uniform sampler2D uDisplacementMap;\n\n        void main(void) {\n            float h = texture2D(uDisplacementMap, vUv).r;\n            gl_FragColor = vec4(vec3(h), 1.0);\n        }\n    "}),a=new pc.Material;a.shader=t,a.setParameter("uDisplacementMap",this.rt.colorBuffer),a.setParameter("uDisplacementStrength",this.displacementStrength);var n=this.entity.render?.meshInstances;if(n)for(var i=0;i<n.length;i++)n[i].material=a;else console.warn("La entidad no tiene componente Render")};var NpcReact=pc.createScript("npcReact");NpcReact.attributes.add("playerTag",{type:"string",default:"Player",title:"Player Tag"}),NpcReact.attributes.add("cashPrefab",{type:"asset",title:"Billete Prefab"}),NpcReact.attributes.add("cashCount",{type:"number",default:5,title:"Cantidad de Billetes"}),NpcReact.attributes.add("spawnRadius",{type:"number",default:1,title:"Radio de ApariciÃ³n"}),NpcReact.prototype.initialize=function(){this.triggered=!1,this.entity.collision?this.entity.collision.on("collisionstart",this.onCollisionStart,this):console.error("â NPC sin componente Collision:",this.entity.name)},NpcReact.prototype.onCollisionStart=function(t){if(!this.triggered&&t.other.tags.has(this.playerTag)){if(this.triggered=!0,console.log("â ColisiÃ³n con el jugador"),this.entity.anim&&(this.entity.anim.setBoolean("isDancing",!0),console.log("ð Cambiando animaciÃ³n")),!this.cashPrefab)return void console.error("â No hay cashPrefab asignado");for(let t=0;t<this.cashCount;t++){let t=this.cashPrefab.resource.instantiate();this.app.root.addChild(t);let i=this.entity.getPosition().clone();i.x+=(Math.random()-.5)*this.spawnRadius,i.z+=(Math.random()-.5)*this.spawnRadius,i.y+=1,console.log("spawn"),t.rigidbody.teleport(i),t.enabled=!0,t.rigidbody?(t.rigidbody.enabled=!0,t.rigidbody.applyImpulse(new pc.Vec3(.1*(Math.random()-.5),.1,.1*(Math.random()-.5)),t.getPosition())):console.warn("â ï¸ Billete sin Rigidbody:",t.name)}}};var CashBehavior=pc.createScript("cashBehavior");CashBehavior.attributes.add("playerTag",{type:"string",default:"Player",title:"Player Tag"}),CashBehavior.prototype.initialize=function(){this.entity.collision?this.entity.collision.on("collisionstart",this.onCollisionStart,this):console.error("â ï¸ El billete no tiene componente Collision:",this.entity.name)},CashBehavior.prototype.onCollisionStart=function(t){t.other.tags.has(this.playerTag)&&(console.log("ð¸ Billete tocÃ³ al jugador. Se destruye."),this.entity.destroy())};var CashSpawner=pc.createScript("cashSpawner");CashSpawner.attributes.add("cashPrefab",{type:"entity",title:"Billete Prefab"}),CashSpawner.attributes.add("cashCount",{type:"number",default:5}),CashSpawner.attributes.add("spawnRadius",{type:"number",default:5}),CashSpawner.prototype.initialize=function(){console.log("ð¦ Script CashSpawner inicializado"),this.spawnCash()},CashSpawner.prototype.spawnCash=function(){if(this.cashPrefab){console.log("ð¦ SpawnCash ejecutado");for(let a=0;a<this.cashCount;a++){let e=this.cashPrefab.clone();this.app.root.addChild(e);let t=this.entity.getPosition().clone();t.x+=(Math.random()-.5)*this.spawnRadius,t.z+=(Math.random()-.5)*this.spawnRadius,t.y+=5,e.setPosition(t),e.enabled=!0,console.log("ð§¾ Billete clonado",a,"en posiciÃ³n",t);let n=e.rigidbody;n?(n.enabled=!0,n.applyImpulse(new pc.Vec3(5*(Math.random()-.5),5,5*(Math.random()-.5)),e.getPosition())):console.warn("â ï¸ El clon no tiene Rigidbody",e.name)}}else console.error("â No hay prefab asignado")};var PlayerController=pc.createScript("playerController");PlayerController.attributes.add("trigger",{type:"entity"}),PlayerController.attributes.add("animEntity",{type:"entity"}),PlayerController.attributes.add("power",{type:"number",default:45e4}),PlayerController.prototype.initialize=function(){this.time=0,this.trigger.collision.on("triggerenter",this.onTriggerEnter,this),this.mark_as_ragdoll=!1},PlayerController.prototype.onTriggerEnter=function(t){"car"!=t.name||this.mark_as_ragdoll||(this.mark_as_ragdoll=!0,SoundManager.instance.setPitch("grunt",pc.math.random(.8,1.2)),SoundManager.instance.playSound("grunt"))},PlayerController.prototype.update=function(t){this.mark_as_ragdoll&&(this.entity.script.ragdoll.changeToRagdoll(),this.enabled=!1)};var Ragdoll=pc.createScript("ragdoll");Ragdoll.prototype.initialize=function(){this._ragdollEntities=this.entity.findByTag("ragdoll"),this._ragdollEntities.sort(((t,i)=>t.graphDepth-i.graphDepth)),this._changed=!1,this._tempPartPos=new pc.Vec3,this.time=0},Ragdoll.prototype.update=function(t){this._active&&(this.time+=t,this.time>10&&(this.entity.enabled=!1,this.entity.destroy()))},Ragdoll.prototype.postUpdate=function(t){if(this._active)for(let t=0;t<this._ragdollEntities.length;++t){const i=this._ragdollEntities[t],e=i.part,o=e.bone.getPosition();o.copy(i.getPosition());const n=this._tempPartPos.copy(i.right).mulScalar(e.positionOffset.x);o.add(n);const s=this._tempPartPos.copy(i.up).mulScalar(e.positionOffset.y);o.add(s);const a=this._tempPartPos.copy(i.forward).mulScalar(-e.positionOffset.z);o.add(a),e.bone.setPosition(o),e.bone.setRotation(i.getRotation())}},Ragdoll.prototype.changeToRagdoll=function(){if(this._active)return;this.entity.enabled=!1,this.entity.anim.enabled=!1,this.entity.script.playerController.enabled=!1,this.entity.rigidbody.enabled=!1,this.entity.rigidbody.mass=.001,this.entity.collision.enabled=!1;const t=this.entity.rigidbody.linearVelocity.clone().mulScalar(2),i=this.entity.rigidbody.angularVelocity.clone(),e=new pc.Vec3,o=new pc.Quat;for(let t=0;t<this._ragdollEntities.length;++t){const i=this._ragdollEntities[t];e.copy(i.getPosition()),o.copy(i.getRotation()),i.rigidbody.mass=.001,i.rigidbody.friction=.9,i.part={positionOffset:i.getLocalPosition().clone().mulScalar(-1),bone:i.parent},i.reparent(this.entity),i.setPosition(e),i.setRotation(o),i.enabled=!0}const n=this._ragdollEntities[0].rigidbody;this._active=!0,this.entity.enabled=!0,n.linearVelocity=t,n.angularVelocity=i};function getOrthogonalVectors(t,i,e){var n,o;Math.abs(t.z)>.7071067811865476?(n=t.y*t.y+t.z*t.z,o=1/Math.sqrt(n),i.x=0,i.y=-t.z*o,i.z=t.y*o,e.x=n*o,e.y=-t.x*i.z,e.z=t.x*i.y):(n=t.x*t.x+t.y*t.y,o=1/Math.sqrt(n),i.x=-t.y*o,i.y=t.x*o,i.z=0,e.x=-t.z*i.y,e.y=t.z*i.x,e.z=n*o)}var PointToPointConstraint=pc.createScript("pointToPointConstraint");PointToPointConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second entity",type:"entity"}),PointToPointConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of entity B (if specified).",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:34e37}),PointToPointConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),PointToPointConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),PointToPointConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),PointToPointConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"entityB"===t||"pivotB"===t?this.createConstraint():"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},PointToPointConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=this.entity.rigidbody.body,i=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);if(this.entityB&&this.entityB.rigidbody){var e=this.entityB.rigidbody.body,n=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);this.constraint=new Ammo.btPoint2PointConstraint(t,e,i,n)}else this.constraint=new Ammo.btPoint2PointConstraint(t,i);this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},PointToPointConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},PointToPointConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},PointToPointConstraint.prototype.update=function(t){if(this.debugRender){var i=new pc.Vec3;this.entity.getWorldTransform().transformPoint(this.pivotA,i),this.app.renderLine(this.entity.getPosition(),i,this.debugColor),this.entityB&&this.app.renderLine(this.entityB.getPosition(),i,this.debugColor)}};var HingeConstraint=pc.createScript("hingeConstraint");HingeConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),HingeConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),HingeConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),HingeConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),HingeConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),HingeConstraint.attributes.add("limits",{title:"Limits",description:"Low and high angular limits for the constraint in degrees. By default, low is greater than high meaning no limits.",type:"vec2",default:[1,-1]}),HingeConstraint.attributes.add("softness",{title:"Softness",description:'Softness of the constraint. Recommend 0.8 to 1. Describes the percentage of limits where movement is free. Beyond this softness percentage, the limit is gradually enforced until the "hard" (1.0) limit is reached.',type:"number",min:0,max:1,default:.9}),HingeConstraint.attributes.add("biasFactor",{title:"Bias Factor",description:"Bias factor of the constraint. Recommend 0.3 +/- approximately 0.3. Strength with which constraint resists zeroth order (angular, not angular velocity) limit violation.",type:"number",min:0,max:1,default:.3}),HingeConstraint.attributes.add("relaxationFactor",{title:"Relaxation Factor",description:"Relaxation factor of the constraint. Recommend to keep this near 1. The lower the value, the less the constraint will fight velocities which violate the angular limits.",type:"number",min:0,max:1,default:1}),HingeConstraint.attributes.add("enableMotor",{title:"Use Motor",description:"Enable a motor to power the automatic rotation around the hinge axis.",type:"boolean",default:!1}),HingeConstraint.attributes.add("motorTargetVelocity",{title:"Target Velocity",description:"Target motor angular velocity.",type:"number",default:0}),HingeConstraint.attributes.add("maxMotorImpulse",{title:"Max Motor Impulse",description:"Maximum motor impulse.",type:"number",default:0}),HingeConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:34e37}),HingeConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),HingeConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),HingeConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),HingeConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){if("pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t)this.createConstraint();else if("limits"===t||"softness"===t||"biasFactor"===t||"relaxationFactor"===t){var n=this.limits.x*Math.PI/180,o=this.limits.y*Math.PI/180;this.constraint.setLimit(n,o,this.softness,this.biasFactor,this.relaxationFactor)}else"enableMotor"===t||"motorTargetVelocity"===t||"maxMotorImpulse"===t?(this.constraint.enableAngularMotor(this.enableMotor,this.motorTargetVelocity*Math.PI/180,this.maxMotorImpulse),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},HingeConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisA.x,this.axisA.y,this.axisA.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btHingeConstraint(o,d,r,l,!1),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btHingeConstraint(o,r,!1);var p=this.limits.x*Math.PI/180,y=this.limits.y*Math.PI/180;this.constraint.setLimit(p,y,this.softness,this.biasFactor,this.relaxationFactor),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.constraint.enableAngularMotor(this.enableMotor,this.motorTargetVelocity*Math.PI/180,this.maxMotorImpulse),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},HingeConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},HingeConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},HingeConstraint.prototype.update=function(t){if(this.debugRender){var i=new pc.Vec3,e=new pc.Vec3,n=new pc.Vec3,o=new pc.Vec3,s=this.entity.getWorldTransform();s.transformPoint(this.pivotA,i),s.transformVector(this.axisA,e),e.normalize().scale(.5),n.add2(i,e),o.sub2(i,e),this.app.renderLine(this.entity.getPosition(),i,this.debugColor),this.app.renderLine(n,o,this.debugColor),this.entityB&&this.app.renderLine(this.entityB.getPosition(),i,this.debugColor)}};var ConeTwistConstraint=pc.createScript("coneTwistConstraint");ConeTwistConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),ConeTwistConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),ConeTwistConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),ConeTwistConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),ConeTwistConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),ConeTwistConstraint.attributes.add("swingSpan1",{title:"Swing 1 Limit",description:"The Swing 1 Limit limits the rotation around the swing axis. Swing 1 Limit limits an axis of rotation orthogonal to the twist axis and Swing Limit 2. The limit angle is symmetric. Therefore, a value of 20 will limit the rotation between -20 and 20 degrees.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("swingSpan2",{title:"Swing 2 Limit",description:"The Swing 2 Limit limits the rotation around the swing axis. Swing 2 Limit limits an axis of rotation orthogonal to the twist axis and Swing Limit 1. The limit angle is symmetric. Therefore, a value of 20 will limit the rotation between -20 and 20 degrees.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("twistSpan",{title:"Twist Limit",description:"The Twist Limit limits the rotation around the twist axis. The limit angle is symmetric. Therefore, a value of 20 will limit the twist rotation between -20 and 20 degrees.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),ConeTwistConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),ConeTwistConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),ConeTwistConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t?this.createConstraint():"swingSpan1"===t?(this.constraint.setLimit(5,this.swingSpan1*Math.PI/180),this.activate()):"swingSpan2"===t?(this.constraint.setLimit(4,this.swingSpan2*Math.PI/180),this.activate()):"twistSpan"===t?(this.constraint.setLimit(3,this.twistSpan*Math.PI/180),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},ConeTwistConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisA.x,this.axisA.y,this.axisA.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btConeTwistConstraint(o,d,r,l),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btConeTwistConstraint(o,r);this.constraint.setLimit(3,this.twistSpan*Math.PI/180),this.constraint.setLimit(4,this.swingSpan2*Math.PI/180),this.constraint.setLimit(5,this.swingSpan1*Math.PI/180),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},ConeTwistConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},ConeTwistConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},ConeTwistConstraint.prototype.update=function(t){this.debugRender&&this.app.renderLine(this.entity.getPosition(),pc.Vec3.ZERO,this.debugColor)};var SliderConstraint=pc.createScript("sliderConstraint");SliderConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),SliderConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),SliderConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),SliderConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),SliderConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),SliderConstraint.attributes.add("linearLimits",{title:"Linear Limits",description:"Linear limits of the constraint.",type:"vec2",default:[1,-1]}),SliderConstraint.attributes.add("angularLimits",{title:"Angular Limits",description:"Angular limits of the constraint.",type:"vec2",default:[0,0]}),SliderConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:1e30}),SliderConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),SliderConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),SliderConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),SliderConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t?this.createConstraint():"linearLimits"===t?(this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.activate()):"angularLimits"===t?(this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},SliderConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([this.axisA.x,this.axisA.y,this.axisA.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(r.setOrigin(s),this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btSliderConstraint(o,d,r,l),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btSliderConstraint(o,r);this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},SliderConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},SliderConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},SliderConstraint.prototype.update=function(t){this.debugRender};var Generic6DofConstraint=pc.createScript("generic6DofConstraint");Generic6DofConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),Generic6DofConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),Generic6DofConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),Generic6DofConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),Generic6DofConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),Generic6DofConstraint.attributes.add("linearLimits",{title:"Linear Limits",description:"Linear limits of the constraint.",type:"vec2",default:[1,-1]}),Generic6DofConstraint.attributes.add("angularLimits",{title:"Angular Limits",description:"Angular limits of the constraint.",type:"vec2",default:[0,0]}),Generic6DofConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:1e30}),Generic6DofConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),Generic6DofConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),Generic6DofConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),Generic6DofConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t?this.createConstraint():"linearLimits"===t?(this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.activate()):"angularLimits"===t?(this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},Generic6DofConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([this.axisA.x,this.axisA.y,this.axisA.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(r.setOrigin(s),this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btSliderConstraint(o,d,r,l),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btSliderConstraint(o,r);this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},Generic6DofConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},Generic6DofConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},Generic6DofConstraint.prototype.update=function(t){this.debugRender};var HumanManager=pc.createScript("humanManager");HumanManager.attributes.add("human_asset",{type:"asset"}),HumanManager.attributes.add("human_count",{type:"number"}),HumanManager.prototype.initialize=function(){HumanManager.instance=this,requestAnimationFrame(function(){this.all_humans=[];for(let a=0;a<this.human_count;a++)this.all_humans.push(this.spawnHuman())}.bind(this))},HumanManager.prototype.spawnHuman=function(){let a=this.human_asset.resource.instantiate();return a.setLocalEulerAngles(0,pc.math.random(0,360),0),a.setPosition(this.placeOnRandomNode()),this.app.root.addChild(a),a},HumanManager.prototype.placeOnRandomNode=function(){let a=DynamicCar.instance.entity.getPosition().clone(),t=AvixUtils.randomInteger(3,5),n=Path.instance.getRandomNodeAtDistanceRadius(a,t);return new pc.Vec3(0,6,0).add(n.getPosition()).add(this.squarePos())},HumanManager.prototype.update=function(a){if(this.all_humans)for(let a=0;a<this.all_humans.length;a++){this.calculateDist(DynamicCar.instance.entity.getPosition().clone(),this.all_humans[a].getPosition().clone())>120&&!this.all_humans[a].script.ragdoll._active&&this.all_humans[a].rigidbody.teleport(this.placeOnRandomNode())}},HumanManager.prototype.squarePos=function(){var a=20*Math.random()-10;return new pc.Vec3(Math.random()<.5?10:a,0,Math.random()<.5?a:10)},HumanManager.prototype.calculateDist=function(a,t){let n=a.x-t.x,e=a.z-t.z;return Math.sqrt(n*n+e*e)},HumanManager.prototype.replaceHuman=function(a){let t=this.all_humans.indexOf(a);a.destroy(),this.all_humans[t]=this.spawnHuman()};var Destructable=pc.createScript("destructable");Destructable.attributes.add("trigger",{type:"entity"}),Destructable.attributes.add("my_rigid_body",{type:"entity"}),Destructable.prototype.initialize=function(){this.time=0,this.activated=!1,this.trigger.collision.on("triggerenter",this.onTriggerEnter,this)},Destructable.prototype.onTriggerEnter=function(t){"car"==t.name&&(this.activated=!0,this.my_rigid_body.rigidbody.enabled=!0)},Destructable.prototype.update=function(t){this.activated&&(this.time+=t,this.time>5&&this.entity.destroy())};